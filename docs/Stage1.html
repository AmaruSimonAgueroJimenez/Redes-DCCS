<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Amaru Simón Agüero Jiménez">

<title>Redes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Stage1_files/libs/clipboard/clipboard.min.js"></script>
<script src="Stage1_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Stage1_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Stage1_files/libs/quarto-html/popper.min.js"></script>
<script src="Stage1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Stage1_files/libs/quarto-html/anchor.min.js"></script>
<link href="Stage1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Stage1_files/libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Stage1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Stage1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Stage1_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>
<script src="Stage1_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="Stage1_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

<script src="Stage1_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="Stage1_files/libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">

<script src="Stage1_files/libs/vis-9.1.0/vis-network.min.js"></script>

<script src="Stage1_files/libs/visNetwork-binding-2.1.2/visNetwork.js"></script>



</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a></li>
  <li><a href="#descripción-de-los-datos" id="toc-descripción-de-los-datos" class="nav-link" data-scroll-target="#descripción-de-los-datos"><span class="header-section-number">2</span> Descripción de los Datos</a>
  <ul>
  <li><a href="#base-de-datos-original" id="toc-base-de-datos-original" class="nav-link" data-scroll-target="#base-de-datos-original"><span class="header-section-number">2.1</span> Base de Datos Original</a></li>
  <li><a href="#datos-de-sustancias-para-análisis-de-red" id="toc-datos-de-sustancias-para-análisis-de-red" class="nav-link" data-scroll-target="#datos-de-sustancias-para-análisis-de-red"><span class="header-section-number">2.2</span> Datos de Sustancias para Análisis de Red</a></li>
  <li><a href="#patrones-de-policonsumo" id="toc-patrones-de-policonsumo" class="nav-link" data-scroll-target="#patrones-de-policonsumo"><span class="header-section-number">2.3</span> Patrones de Policonsumo</a></li>
  </ul></li>
  <li><a href="#construcción-de-la-red" id="toc-construcción-de-la-red" class="nav-link" data-scroll-target="#construcción-de-la-red"><span class="header-section-number">3</span> Construcción de la Red</a>
  <ul>
  <li><a href="#matriz-de-co-ocurrencia" id="toc-matriz-de-co-ocurrencia" class="nav-link" data-scroll-target="#matriz-de-co-ocurrencia"><span class="header-section-number">3.1</span> Matriz de Co-ocurrencia</a></li>
  <li><a href="#estructura-de-la-red" id="toc-estructura-de-la-red" class="nav-link" data-scroll-target="#estructura-de-la-red"><span class="header-section-number">3.2</span> Estructura de la Red</a></li>
  </ul></li>
  <li><a href="#visualización-de-la-red" id="toc-visualización-de-la-red" class="nav-link" data-scroll-target="#visualización-de-la-red"><span class="header-section-number">4</span> Visualización de la Red</a>
  <ul>
  <li><a href="#red-estática" id="toc-red-estática" class="nav-link" data-scroll-target="#red-estática"><span class="header-section-number">4.1</span> Red Estática</a></li>
  <li><a href="#red-interactiva" id="toc-red-interactiva" class="nav-link" data-scroll-target="#red-interactiva"><span class="header-section-number">4.2</span> Red Interactiva</a></li>
  </ul></li>
  <li><a href="#análisis-de-centralidad" id="toc-análisis-de-centralidad" class="nav-link" data-scroll-target="#análisis-de-centralidad"><span class="header-section-number">5</span> Análisis de Centralidad</a>
  <ul>
  <li><a href="#métricas-de-centralidad" id="toc-métricas-de-centralidad" class="nav-link" data-scroll-target="#métricas-de-centralidad"><span class="header-section-number">5.1</span> Métricas de Centralidad</a></li>
  <li><a href="#comparación-visual-de-centralidades" id="toc-comparación-visual-de-centralidades" class="nav-link" data-scroll-target="#comparación-visual-de-centralidades"><span class="header-section-number">5.2</span> Comparación Visual de Centralidades</a></li>
  </ul></li>
  <li><a href="#análisis-de-comunidades" id="toc-análisis-de-comunidades" class="nav-link" data-scroll-target="#análisis-de-comunidades"><span class="header-section-number">6</span> Análisis de Comunidades</a>
  <ul>
  <li><a href="#visualización-de-comunidades" id="toc-visualización-de-comunidades" class="nav-link" data-scroll-target="#visualización-de-comunidades"><span class="header-section-number">6.1</span> Visualización de Comunidades</a></li>
  </ul></li>
  <li><a href="#patrones-de-co-consumo" id="toc-patrones-de-co-consumo" class="nav-link" data-scroll-target="#patrones-de-co-consumo"><span class="header-section-number">7</span> Patrones de Co-consumo</a>
  <ul>
  <li><a href="#tríadas-más-frecuentes" id="toc-tríadas-más-frecuentes" class="nav-link" data-scroll-target="#tríadas-más-frecuentes"><span class="header-section-number">7.1</span> Tríadas Más Frecuentes</a></li>
  <li><a href="#matriz-de-calor" id="toc-matriz-de-calor" class="nav-link" data-scroll-target="#matriz-de-calor"><span class="header-section-number">7.2</span> Matriz de Calor</a></li>
  </ul></li>
  <li><a href="#análisis-de-distribución-de-grado" id="toc-análisis-de-distribución-de-grado" class="nav-link" data-scroll-target="#análisis-de-distribución-de-grado"><span class="header-section-number">8</span> Análisis de Distribución de Grado</a></li>
  <li><a href="#medidas-de-centralización" id="toc-medidas-de-centralización" class="nav-link" data-scroll-target="#medidas-de-centralización"><span class="header-section-number">9</span> Medidas de Centralización</a></li>
  <li><a href="#conclusiones" id="toc-conclusiones" class="nav-link" data-scroll-target="#conclusiones"><span class="header-section-number">10</span> Conclusiones</a>
  <ul>
  <li><a href="#hallazgos-principales" id="toc-hallazgos-principales" class="nav-link" data-scroll-target="#hallazgos-principales"><span class="header-section-number">10.1</span> Hallazgos Principales</a></li>
  <li><a href="#implicaciones" id="toc-implicaciones" class="nav-link" data-scroll-target="#implicaciones"><span class="header-section-number">10.2</span> Implicaciones</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Redes</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor/a</div>
    <div class="quarto-title-meta-contents">
             <p>Amaru Simón Agüero Jiménez <a href="mailto:aaguero@miaundes.cl" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0001-7336-1833" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Fecha de publicación</div>
    <div class="quarto-title-meta-contents">
      <p class="date">19 de agosto de 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<p>Este documento presenta un análisis comprehensivo de las redes de policonsumo de sustancias basado en datos del sistema de salud. El análisis utiliza teoría de grafos para identificar patrones de co-ocurrencia y relaciones entre diferentes sustancias consumidas por los pacientes.</p>
</section>
<section id="descripción-de-los-datos" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Descripción de los Datos</h1>
<section id="base-de-datos-original" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="base-de-datos-original"><span class="header-section-number">2.1</span> Base de Datos Original</h2>
<div class="cell" data-tbl-cap="Características generales de la base de datos">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Información general del dataset</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>info_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  Característica <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Total de registros"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Período de análisis"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Variables totales"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Variables de sustancias"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Variables de diagnóstico DSM-IV"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Variables de diagnóstico CIE-10"</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">c</span>(<span class="fu">format</span>(<span class="fu">nrow</span>(data), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"2010-2022"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.character</span>(<span class="fu">ncol</span>(data)),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"4"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"4"</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"4"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>info_data <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Característica"</span>, <span class="st">"Valor"</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"300px"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">width =</span> <span class="st">"150px"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Características generales de la base de datos</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Característica</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 300px; font-weight: bold;">Total de registros</td>
<td style="text-align: right; width: 150px;">223,061</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px; font-weight: bold;">Período de análisis</td>
<td style="text-align: right; width: 150px;">2010-2022</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 300px; font-weight: bold;">Variables totales</td>
<td style="text-align: right; width: 150px;">99</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px; font-weight: bold;">Variables de sustancias</td>
<td style="text-align: right; width: 150px;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 300px; font-weight: bold;">Variables de diagnóstico DSM-IV</td>
<td style="text-align: right; width: 150px;">4</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px; font-weight: bold;">Variables de diagnóstico CIE-10</td>
<td style="text-align: right; width: 150px;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="datos-de-sustancias-para-análisis-de-red" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="datos-de-sustancias-para-análisis-de-red"><span class="header-section-number">2.2</span> Datos de Sustancias para Análisis de Red</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar datos de sustancias</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>cols_sustancias <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sustancia_principal"</span>, <span class="st">"otras_sustancias_no1"</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"otras_sustancias_no2"</span>, <span class="st">"otras_sustancias_no3"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Función de simplificación</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>simplify_substance_names <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.character</span>(x)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  x[<span class="fu">str_detect</span>(x, <span class="st">"^Sin "</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(x, <span class="st">"^Sedantes:.*"</span>, <span class="st">"Sedantes/Benzodiacepinas"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(x, <span class="st">"^Hipnóticos:.*"</span>, <span class="st">"Hipnóticos"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(x, <span class="st">"^Inhalables:.*"</span>, <span class="st">"Inhalables"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(x, <span class="st">"^Otros Opioides.*"</span>, <span class="st">"Opioides"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(x, <span class="st">"^Otros Estimulantes.*"</span>, <span class="st">"Estimulantes"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(x, <span class="st">"^Otros Alucinógenos.*"</span>, <span class="st">"Alucinógenos"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(x, <span class="st">"^Éxtasis.*"</span>, <span class="st">"Éxtasis/MDMA"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar limpieza</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>data_network <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(cols_sustancias)) <span class="sc">%&gt;%</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), simplify_substance_names)) <span class="sc">%&gt;%</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sustancia_principal))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tbl-cap="Distribución de sustancias principales consumidas">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabla de frecuencias de sustancia principal</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sust_principal <span class="ot">&lt;-</span> data_network <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sustancia_principal, <span class="at">name =</span> <span class="st">"Frecuencia"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Frecuencia)) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Porcentaje =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> Frecuencia <span class="sc">/</span> <span class="fu">sum</span>(Frecuencia), <span class="dv">1</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Acumulado =</span> <span class="fu">cumsum</span>(Porcentaje)) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>sust_principal <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Sustancia Principal"</span>, <span class="st">"Frecuencia"</span>, <span class="st">"Porcentaje (%)"</span>, <span class="st">"Acumulado (%)"</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"250px"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f0f0f0"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Distribución de sustancias principales consumidas</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Sustancia Principal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Frecuencia</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Porcentaje (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Acumulado (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 250px; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">Pasta Base</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">84166</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">37.7</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">37.7</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">Alcohol</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">78234</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">35.1</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">72.8</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">Cocaína</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">42073</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">18.9</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">91.7</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px;">Marihuana</td>
<td style="text-align: right;">13797</td>
<td style="text-align: right;">6.2</td>
<td style="text-align: right;">97.9</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px;">Sedantes/Benzodiacepinas</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">98.8</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px;">Opioides</td>
<td style="text-align: right;">996</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: right;">99.2</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px;">Sedantes</td>
<td style="text-align: right;">614</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">99.5</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px;">Otros</td>
<td style="text-align: right;">270</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">99.6</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px;">Inhalables</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px;">Hipnóticos</td>
<td style="text-align: right;">145</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">99.8</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px;">Estimulantes</td>
<td style="text-align: right;">134</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">99.9</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px;">Anfetaminas</td>
<td style="text-align: right;">131</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px;">Éxtasis/MDMA</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px;">Alucinógenos</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px;">Crack</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="patrones-de-policonsumo" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="patrones-de-policonsumo"><span class="header-section-number">2.3</span> Patrones de Policonsumo</h2>
<div class="cell" data-tbl-cap="Distribución del número de sustancias consumidas">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contar combinaciones</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>combo_stats <span class="ot">&lt;-</span> data_network <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_sustancias =</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">select</span>(., <span class="fu">all_of</span>(cols_sustancias))))) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(n_sustancias) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Casos =</span> <span class="fu">n</span>(),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Porcentaje =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="fu">nrow</span>(data_network), <span class="dv">2</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n_sustancias)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>combo_stats <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Número de Sustancias"</span>, <span class="st">"Casos"</span>, <span class="st">"Porcentaje (%)"</span>),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"c"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">width =</span> <span class="st">"150px"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">"Patrones de Policonsumo"</span> <span class="ot">=</span> <span class="dv">3</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Distribución del número de sustancias consumidas</caption>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Patrones de Policonsumo
</div></th>
</tr>
<tr class="even">
<th style="text-align: center;" data-quarto-table-cell-role="th">Número de Sustancias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Casos</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Porcentaje (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center; width: 150px; font-weight: bold;">1</td>
<td style="text-align: right;">64772</td>
<td style="text-align: right;">29.04</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 150px; font-weight: bold;">2</td>
<td style="text-align: right;">75960</td>
<td style="text-align: right;">34.05</td>
</tr>
<tr class="odd">
<td style="text-align: center; width: 150px; font-weight: bold;">3</td>
<td style="text-align: right;">55509</td>
<td style="text-align: right;">24.89</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 150px; font-weight: bold;">4</td>
<td style="text-align: right;">26814</td>
<td style="text-align: right;">12.02</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combo_stats, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(n_sustancias), <span class="at">y =</span> Casos)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Casos, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, Porcentaje, <span class="st">"%)"</span>)),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>)),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Número de Sustancias Consumidas"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Número de Casos"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Distribución del Policonsumo"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"N ="</span>, <span class="fu">format</span>(<span class="fu">nrow</span>(data_network), <span class="at">big.mark =</span> <span class="st">","</span>))) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stage1_files/figure-html/policonsumo-plot-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Distribución del policonsumo de sustancias</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="construcción-de-la-red" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Construcción de la Red</h1>
<section id="matriz-de-co-ocurrencia" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="matriz-de-co-ocurrencia"><span class="header-section-number">3.1</span> Matriz de Co-ocurrencia</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear matriz de co-ocurrencia</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>create_cooccurrence_matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  all_substances <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(df[cols_sustancias]))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  all_substances <span class="ot">&lt;-</span> all_substances[<span class="sc">!</span><span class="fu">is.na</span>(all_substances)]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  all_substances <span class="ot">&lt;-</span> <span class="fu">sort</span>(all_substances)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  n_sust <span class="ot">&lt;-</span> <span class="fu">length</span>(all_substances)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  co_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_sust, <span class="at">ncol =</span> n_sust,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dimnames =</span> <span class="fu">list</span>(all_substances, all_substances))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    row_substances <span class="ot">&lt;-</span> <span class="fu">unlist</span>(df[i, cols_sustancias])</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    row_substances <span class="ot">&lt;-</span> row_substances[<span class="sc">!</span><span class="fu">is.na</span>(row_substances)]</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(row_substances) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(row_substances)<span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (k <span class="cf">in</span> (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(row_substances)) {</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>          sust1 <span class="ot">&lt;-</span> row_substances[j]</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>          sust2 <span class="ot">&lt;-</span> row_substances[k]</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>          co_matrix[sust1, sust2] <span class="ot">&lt;-</span> co_matrix[sust1, sust2] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>          co_matrix[sust2, sust1] <span class="ot">&lt;-</span> co_matrix[sust2, sust1] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(co_matrix)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>co_matrix <span class="ot">&lt;-</span> <span class="fu">create_cooccurrence_matrix</span>(data_network)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tbl-cap="Top 10 pares de sustancias con mayor co-ocurrencia">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer pares más frecuentes</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>upper_tri <span class="ot">&lt;-</span> <span class="fu">upper.tri</span>(co_matrix)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>pairs_df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">row =</span> <span class="fu">rownames</span>(co_matrix), </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col =</span> <span class="fu">colnames</span>(co_matrix), </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>pairs_df<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(co_matrix)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>top_pairs <span class="ot">&lt;-</span> pairs_df <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.vector</span>(upper_tri)) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Par =</span> <span class="fu">paste</span>(row, <span class="st">"↔"</span>, col)) <span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Par, value) <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Coocurrencias =</span> value)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>top_pairs <span class="sc">%&gt;%</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Par de Sustancias"</span>, <span class="st">"Co-ocurrencias"</span>),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"300px"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">width =</span> <span class="st">"150px"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Top 10 pares de sustancias con mayor co-ocurrencia</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Par de Sustancias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Co-ocurrencias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 300px;">Alcohol ↔︎ Marihuana</td>
<td style="text-align: right; width: 150px; font-weight: bold;">74757</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px;">Alcohol ↔︎ Pasta Base</td>
<td style="text-align: right; width: 150px; font-weight: bold;">71783</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 300px;">Alcohol ↔︎ Cocaína</td>
<td style="text-align: right; width: 150px; font-weight: bold;">69780</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px;">Marihuana ↔︎ Pasta Base</td>
<td style="text-align: right; width: 150px; font-weight: bold;">55791</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 300px;">Cocaína ↔︎ Marihuana</td>
<td style="text-align: right; width: 150px; font-weight: bold;">47950</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px;">Cocaína ↔︎ Pasta Base</td>
<td style="text-align: right; width: 150px; font-weight: bold;">37270</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 300px;">Alcohol ↔︎ Sedantes/Benzodiacepinas</td>
<td style="text-align: right; width: 150px; font-weight: bold;">5681</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px;">Alcohol ↔︎ Otros</td>
<td style="text-align: right; width: 150px; font-weight: bold;">3165</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 300px;">Marihuana ↔︎ Sedantes/Benzodiacepinas</td>
<td style="text-align: right; width: 150px; font-weight: bold;">2572</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px;">Cocaína ↔︎ Sedantes/Benzodiacepinas</td>
<td style="text-align: right; width: 150px; font-weight: bold;">2278</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="estructura-de-la-red" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="estructura-de-la-red"><span class="header-section-number">3.2</span> Estructura de la Red</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear grafo</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>g_full <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  co_matrix,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"undirected"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weighted =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag =</span> <span class="cn">FALSE</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar umbral para visualización</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>min_weight <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">delete_edges</span>(g_full, <span class="fu">E</span>(g_full)[weight <span class="sc">&lt;</span> min_weight])</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">delete_vertices</span>(g, <span class="fu">degree</span>(g) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Detectar comunidades</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>communities <span class="ot">&lt;-</span> <span class="fu">cluster_louvain</span>(g)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g)<span class="sc">$</span>community <span class="ot">&lt;-</span> <span class="fu">membership</span>(communities)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tbl-cap="Propiedades estructurales de la red">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular propiedades</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>network_props <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Propiedad =</span> <span class="fu">c</span>(<span class="st">"Número de nodos (vértices)"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Número de enlaces (edges)"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Densidad de la red"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Diámetro"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Distancia media"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Coeficiente de clustering"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Componentes conectados"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Comunidades detectadas"</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">c</span>(<span class="fu">vcount</span>(g),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ecount</span>(g),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="fu">edge_density</span>(g), <span class="dv">4</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">diameter</span>(g, <span class="at">weights =</span> <span class="cn">NA</span>),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="fu">mean_distance</span>(g, <span class="at">weights =</span> <span class="cn">NA</span>), <span class="dv">2</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="fu">transitivity</span>(g, <span class="at">type =</span> <span class="st">"global"</span>), <span class="dv">3</span>),</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">components</span>(g)<span class="sc">$</span>no,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">length</span>(communities))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>network_props <span class="sc">%&gt;%</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Propiedad de la Red"</span>, <span class="st">"Valor"</span>),</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"300px"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">width =</span> <span class="st">"150px"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Propiedades estructurales de la red</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Propiedad de la Red</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 300px; font-weight: bold;">Número de nodos (vértices)</td>
<td style="text-align: right; width: 150px;">13.0000</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px; font-weight: bold;">Número de enlaces (edges)</td>
<td style="text-align: right; width: 150px;">33.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 300px; font-weight: bold;">Densidad de la red</td>
<td style="text-align: right; width: 150px;">0.4231</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px; font-weight: bold;">Diámetro</td>
<td style="text-align: right; width: 150px;">3.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 300px; font-weight: bold;">Distancia media</td>
<td style="text-align: right; width: 150px;">1.6000</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px; font-weight: bold;">Coeficiente de clustering</td>
<td style="text-align: right; width: 150px;">0.5510</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 300px; font-weight: bold;">Componentes conectados</td>
<td style="text-align: right; width: 150px;">1.0000</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 300px; font-weight: bold;">Comunidades detectadas</td>
<td style="text-align: right; width: 150px;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="visualización-de-la-red" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Visualización de la Red</h1>
<section id="red-estática" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="red-estática"><span class="header-section-number">4.1</span> Red Estática</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir a tidygraph</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>g_tidy <span class="ot">&lt;-</span> <span class="fu">as_tbl_graph</span>(g)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular métricas para el tamaño</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>node_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">V</span>(g)<span class="sc">$</span>name,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree =</span> <span class="fu">degree</span>(g),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">strength =</span> <span class="fu">strength</span>(g),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">betweenness =</span> <span class="fu">betweenness</span>(g),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">community =</span> <span class="fu">V</span>(g)<span class="sc">$</span>community</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear visualización mejorada</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>p_network <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(g_tidy, <span class="at">layout =</span> <span class="st">'fr'</span>, <span class="at">weights =</span> weight) <span class="sc">+</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">width =</span> weight, <span class="at">alpha =</span> weight),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"gray40"</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> <span class="fu">strength</span>(g), </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="fu">factor</span>(<span class="fu">V</span>(g)<span class="sc">$</span>community)),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name, </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> <span class="fu">sqrt</span>(<span class="fu">strength</span>(g))<span class="sc">/</span><span class="dv">50</span>),</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">repel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">force =</span> <span class="dv">3</span>,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">segment.size =</span> <span class="fl">0.2</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">segment.alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_width_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_alpha_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.7</span>)) <span class="sc">+</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">15</span>),</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"Fuerza</span><span class="sc">\n</span><span class="st">(suma de pesos)"</span>,</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>,</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Comunidad"</span>) <span class="sc">+</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Red de Policonsumo de Sustancias"</span>,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"Basado en %s casos | Mínimo %s co-ocurrencias"</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">format</span>(<span class="fu">nrow</span>(data_network), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">format</span>(min_weight, <span class="at">big.mark =</span> <span class="st">","</span>))) <span class="sc">+</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_network)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stage1_files/figure-html/network-viz-static-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Red de co-ocurrencia de sustancias (umbral mínimo: 500 co-ocurrencias)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="red-interactiva" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="red-interactiva"><span class="header-section-number">4.2</span> Red Interactiva</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular layout con mejor separación</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">layout_with_fr</span>(g, <span class="at">weights =</span> <span class="fu">E</span>(g)<span class="sc">$</span>weight)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> coords <span class="sc">*</span> <span class="dv">150</span>  <span class="co"># Escalar para mejor separación</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar datos para visNetwork</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>nodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">V</span>(g)<span class="sc">$</span>name,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">V</span>(g)<span class="sc">$</span>name,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">sqrt</span>(<span class="fu">strength</span>(g)),  <span class="co"># Raíz cuadrada para reducir diferencias extremas</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">V</span>(g)<span class="sc">$</span>community,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> coords[,<span class="dv">1</span>],</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> coords[,<span class="dv">2</span>],</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&lt;b&gt;"</span>, <span class="fu">V</span>(g)<span class="sc">$</span>name, <span class="st">"&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Fuerza: "</span>, <span class="fu">format</span>(<span class="fu">round</span>(<span class="fu">strength</span>(g), <span class="dv">0</span>), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Conexiones: "</span>, <span class="fu">degree</span>(g), <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Comunidad: "</span>, <span class="fu">V</span>(g)<span class="sc">$</span>community</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">font.size =</span> <span class="fu">ifelse</span>(<span class="fu">strength</span>(g) <span class="sc">&gt;</span> <span class="fu">quantile</span>(<span class="fu">strength</span>(g), <span class="fl">0.75</span>), <span class="dv">20</span>, <span class="dv">14</span>),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">physics =</span> <span class="cn">FALSE</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar y fijar nodos principales</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>top_nodes <span class="ot">&lt;-</span> <span class="fu">head</span>(node_metrics<span class="sc">$</span>name[<span class="fu">order</span>(node_metrics<span class="sc">$</span>strength, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)], <span class="dv">4</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>nodes<span class="sc">$</span>fixed.x <span class="ot">&lt;-</span> nodes<span class="sc">$</span>id <span class="sc">%in%</span> top_nodes</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>nodes<span class="sc">$</span>fixed.y <span class="ot">&lt;-</span> nodes<span class="sc">$</span>id <span class="sc">%in%</span> top_nodes</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar posiciones de nodos principales para mejor separación</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"Alcohol"</span> <span class="sc">%in%</span> nodes<span class="sc">$</span>id) {</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  nodes[nodes<span class="sc">$</span>id <span class="sc">==</span> <span class="st">"Alcohol"</span>, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">200</span>, <span class="dv">0</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"Marihuana"</span> <span class="sc">%in%</span> nodes<span class="sc">$</span>id) {</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  nodes[nodes<span class="sc">$</span>id <span class="sc">==</span> <span class="st">"Marihuana"</span>, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">0</span>)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"Pasta Base"</span> <span class="sc">%in%</span> nodes<span class="sc">$</span>id) {</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  nodes[nodes<span class="sc">$</span>id <span class="sc">==</span> <span class="st">"Pasta Base"</span>, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"Cocaína"</span> <span class="sc">%in%</span> nodes<span class="sc">$</span>id) {</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  nodes[nodes<span class="sc">$</span>id <span class="sc">==</span> <span class="st">"Cocaína"</span>, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">200</span>)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar edges</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>edges_df <span class="ot">&lt;-</span> <span class="fu">as_data_frame</span>(g, <span class="at">what =</span> <span class="st">"edges"</span>)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> edges_df<span class="sc">$</span>from,</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> edges_df<span class="sc">$</span>to,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> edges_df<span class="sc">$</span>weight <span class="sc">/</span> <span class="dv">1000</span>,  <span class="co"># Escalar para visualización</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    edges_df<span class="sc">$</span>from, <span class="st">" ↔ "</span>, edges_df<span class="sc">$</span>to, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Co-ocurrencias: "</span>, <span class="fu">format</span>(edges_df<span class="sc">$</span>weight, <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">list</span>(</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"rgba(150,150,150,0.3)"</span>,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlight =</span> <span class="st">"rgba(255,100,100,0.8)"</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear visualización interactiva</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(nodes, edges, <span class="at">height =</span> <span class="st">"600px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visOptions</span>(</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlightNearest =</span> <span class="fu">list</span>(</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">enabled =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">hover =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree =</span> <span class="dv">1</span>,</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">labelOnly =</span> <span class="cn">FALSE</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodesIdSelection =</span> <span class="fu">list</span>(</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">enabled =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">'width: 200px; height: 30px;'</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">selectedBy =</span> <span class="fu">list</span>(</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> <span class="st">"group"</span>,</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">'width: 200px; height: 30px;'</span>,</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">"Seleccionar Comunidad"</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visPhysics</span>(</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">enabled =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">stabilization =</span> <span class="fu">list</span>(</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">enabled =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">iterations =</span> <span class="dv">200</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">barnesHut =</span> <span class="fu">list</span>(</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">gravitationalConstant =</span> <span class="sc">-</span><span class="dv">5000</span>,</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">springConstant =</span> <span class="fl">0.001</span>,</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">springLength =</span> <span class="dv">200</span>,</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">damping =</span> <span class="fl">0.3</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLayout</span>(</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomSeed =</span> <span class="dv">123</span>,</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">improvedLayout =</span> <span class="cn">TRUE</span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visInteraction</span>(</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">navigationButtons =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">dragNodes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">dragView =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">zoomView =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">tooltipDelay =</span> <span class="dv">0</span></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visEdges</span>(</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="fu">list</span>(</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">enabled =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"continuous"</span>,</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">roundness =</span> <span class="fl">0.5</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">2</span>,</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">physics =</span> <span class="cn">TRUE</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visNodes</span>(</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"dot"</span>,</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">scaling =</span> <span class="fu">list</span>(</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">min =</span> <span class="dv">10</span>,</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">max =</span> <span class="dv">40</span></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">borderWidth =</span> <span class="dv">2</span>,</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">borderWidthSelected =</span> <span class="dv">4</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLegend</span>(</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">enabled =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"right"</span>,</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.15</span>,</span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">useGroups =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"Comunidades"</span></span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visConfigure</span>(<span class="at">enabled =</span> <span class="cn">FALSE</span>)  <span class="co"># Desactivar menú de configuración</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-06a1c0f6f57c0d5783f1" style="width:100%;height:600px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-06a1c0f6f57c0d5783f1">{"x":{"nodes":{"id":["Alcohol","Anfetaminas","Cocaína","Estimulantes","Éxtasis/MDMA","Inhalables","Lsd","Marihuana","Opioides","Otros","Pasta Base","Sedantes","Sedantes/Benzodiacepinas"],"label":["Alcohol","Anfetaminas","Cocaína","Estimulantes","Éxtasis/MDMA","Inhalables","Lsd","Marihuana","Opioides","Otros","Pasta Base","Sedantes","Sedantes/Benzodiacepinas"],"value":[480.4164859785726,59.94997914928745,402.9305151015495,26.49528259898354,33.36165463522455,61.78187436457395,22.93468988235943,433.280509600882,45.17742799230607,86.61408661412992,413.0242123653285,71.21797525905943,111.557160236356],"group":[1,1,1,1,1,1,1,1,1,1,1,1,1],"x":[-200,9.349041411121958,0,60.73312067047058,14.85090551940396,10.50584187222599,-16.49494425500816,200,18.84088809489974,38.77430871905196,0,33.85762435915507,27.9813615626391],"y":[0,-74.77788662892598,-200,-71.72140923204989,-112.9980722266237,-92.71586461865525,-89.43124142928363,0,-58.89298768075231,-83.43987616202168,200,-97.42314489740504,-71.69219747362051],"title":["<b>Alcohol<\/b><br>Fuerza: 230,800<br>Conexiones: 10<br>Comunidad: 1","<b>Anfetaminas<\/b><br>Fuerza:   3,594<br>Conexiones: 4<br>Comunidad: 1","<b>Cocaína<\/b><br>Fuerza: 162,353<br>Conexiones: 10<br>Comunidad: 1","<b>Estimulantes<\/b><br>Fuerza:     702<br>Conexiones: 1<br>Comunidad: 1","<b>Éxtasis/MDMA<\/b><br>Fuerza:   1,113<br>Conexiones: 2<br>Comunidad: 1","<b>Inhalables<\/b><br>Fuerza:   3,817<br>Conexiones: 4<br>Comunidad: 1","<b>Lsd<\/b><br>Fuerza:     526<br>Conexiones: 1<br>Comunidad: 1","<b>Marihuana<\/b><br>Fuerza: 187,732<br>Conexiones: 11<br>Comunidad: 1","<b>Opioides<\/b><br>Fuerza:   2,041<br>Conexiones: 3<br>Comunidad: 1","<b>Otros<\/b><br>Fuerza:   7,502<br>Conexiones: 4<br>Comunidad: 1","<b>Pasta Base<\/b><br>Fuerza: 170,589<br>Conexiones: 8<br>Comunidad: 1","<b>Sedantes<\/b><br>Fuerza:   5,072<br>Conexiones: 4<br>Comunidad: 1","<b>Sedantes/Benzodiacepinas<\/b><br>Fuerza:  12,445<br>Conexiones: 4<br>Comunidad: 1"],"font.size":[20,14,14,14,14,14,14,20,14,14,20,14,14],"physics":[false,false,false,false,false,false,false,false,false,false,false,false,false],"fixed.x":[true,false,true,false,false,false,false,true,false,false,true,false,false],"fixed.y":[true,false,true,false,false,false,false,true,false,false,true,false,false]},"edges":{"from":["Alcohol","Alcohol","Alcohol","Alcohol","Alcohol","Alcohol","Alcohol","Alcohol","Alcohol","Alcohol","Anfetaminas","Anfetaminas","Anfetaminas","Cocaína","Cocaína","Cocaína","Cocaína","Cocaína","Cocaína","Cocaína","Cocaína","Éxtasis/MDMA","Inhalables","Inhalables","Lsd","Marihuana","Marihuana","Marihuana","Marihuana","Marihuana","Otros","Pasta Base","Pasta Base"],"to":["Anfetaminas","Cocaína","Estimulantes","Inhalables","Marihuana","Opioides","Otros","Pasta Base","Sedantes","Sedantes/Benzodiacepinas","Cocaína","Marihuana","Pasta Base","Éxtasis/MDMA","Inhalables","Marihuana","Opioides","Otros","Pasta Base","Sedantes","Sedantes/Benzodiacepinas","Marihuana","Marihuana","Pasta Base","Marihuana","Opioides","Otros","Pasta Base","Sedantes","Sedantes/Benzodiacepinas","Pasta Base","Sedantes","Sedantes/Benzodiacepinas"],"value":[1.111,69.78,0.702,1.182,74.75700000000001,0.769,3.165,71.783,1.87,5.681,0.952,0.872,0.659,0.54,0.549,47.95,0.554,1.286,37.27,1.194,2.278,0.573,1.02,1.066,0.526,0.718,1.639,55.791,1.314,2.572,1.412,0.694,1.914],"title":["Alcohol ↔ Anfetaminas<br>Co-ocurrencias:  1,111","Alcohol ↔ Cocaína<br>Co-ocurrencias: 69,780","Alcohol ↔ Estimulantes<br>Co-ocurrencias:    702","Alcohol ↔ Inhalables<br>Co-ocurrencias:  1,182","Alcohol ↔ Marihuana<br>Co-ocurrencias: 74,757","Alcohol ↔ Opioides<br>Co-ocurrencias:    769","Alcohol ↔ Otros<br>Co-ocurrencias:  3,165","Alcohol ↔ Pasta Base<br>Co-ocurrencias: 71,783","Alcohol ↔ Sedantes<br>Co-ocurrencias:  1,870","Alcohol ↔ Sedantes/Benzodiacepinas<br>Co-ocurrencias:  5,681","Anfetaminas ↔ Cocaína<br>Co-ocurrencias:    952","Anfetaminas ↔ Marihuana<br>Co-ocurrencias:    872","Anfetaminas ↔ Pasta Base<br>Co-ocurrencias:    659","Cocaína ↔ Éxtasis/MDMA<br>Co-ocurrencias:    540","Cocaína ↔ Inhalables<br>Co-ocurrencias:    549","Cocaína ↔ Marihuana<br>Co-ocurrencias: 47,950","Cocaína ↔ Opioides<br>Co-ocurrencias:    554","Cocaína ↔ Otros<br>Co-ocurrencias:  1,286","Cocaína ↔ Pasta Base<br>Co-ocurrencias: 37,270","Cocaína ↔ Sedantes<br>Co-ocurrencias:  1,194","Cocaína ↔ Sedantes/Benzodiacepinas<br>Co-ocurrencias:  2,278","Éxtasis/MDMA ↔ Marihuana<br>Co-ocurrencias:    573","Inhalables ↔ Marihuana<br>Co-ocurrencias:  1,020","Inhalables ↔ Pasta Base<br>Co-ocurrencias:  1,066","Lsd ↔ Marihuana<br>Co-ocurrencias:    526","Marihuana ↔ Opioides<br>Co-ocurrencias:    718","Marihuana ↔ Otros<br>Co-ocurrencias:  1,639","Marihuana ↔ Pasta Base<br>Co-ocurrencias: 55,791","Marihuana ↔ Sedantes<br>Co-ocurrencias:  1,314","Marihuana ↔ Sedantes/Benzodiacepinas<br>Co-ocurrencias:  2,572","Otros ↔ Pasta Base<br>Co-ocurrencias:  1,412","Pasta Base ↔ Sedantes<br>Co-ocurrencias:    694","Pasta Base ↔ Sedantes/Benzodiacepinas<br>Co-ocurrencias:  1,914"],"color.color":["rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)","rgba(150,150,150,0.3)"],"color.highlight":["rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)","rgba(255,100,100,0.8)"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","borderWidth":2,"borderWidthSelected":4,"scaling":{"min":10,"max":40}},"manipulation":{"enabled":false},"interaction":{"dragNodes":true,"dragView":true,"hover":true,"navigationButtons":true,"tooltipDelay":0,"zoomView":true,"zoomSpeed":1},"physics":{"stabilization":{"enabled":true,"iterations":200},"enabled":true,"barnesHut":{"gravitationalConstant":-5000,"springConstant":0.001,"springLength":200,"damping":0.3}},"layout":{"randomSeed":123,"improvedLayout":true},"edges":{"width":2,"physics":true,"smooth":{"enabled":true,"type":"continuous","roundness":0.5}},"configure":{"enabled":false}},"groups":["1"],"width":"100%","height":"600px","idselection":{"enabled":true,"style":"width: 200px; height: 30px;","useLabels":true,"main":"Select by id"},"byselection":{"enabled":true,"style":"width: 200px; height: 30px;","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false,"variable":"group","main":"Seleccionar Comunidad","values":["1"]},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":true,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":false},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","legend":{"width":0.15,"useGroups":true,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"main":{"text":"Comunidades","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:14px;text-align:center;"}}},"evals":[],"jsHooks":[]}</script>
<p>Red interactiva de co-ocurrencia (explora con zoom y arrastre)</p>
</div>
</div>
<p>Red de Co-ocurrencia Ponderada No Dirigida.</p>
<p>Clasificación Principal:</p>
<ul>
<li>Red de co-ocurrencia: Los enlaces representan la frecuencia con que dos sustancias aparecen juntas en el mismo paciente</li>
<li>Red unimodal: Todos los nodos son del mismo tipo (sustancias)</li>
<li>Red ponderada: Los edges tienen pesos que representan el número de co-ocurrencias</li>
<li>Red no dirigida: La relación de co-consumo es simétrica (si A se consume con B, B se consume con A)</li>
</ul>
</section>
</section>
<section id="análisis-de-centralidad" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Análisis de Centralidad</h1>
<section id="métricas-de-centralidad" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="métricas-de-centralidad"><span class="header-section-number">5.1</span> Métricas de Centralidad</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular todas las métricas de centralidad</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>centrality_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sustancia =</span> <span class="fu">V</span>(g)<span class="sc">$</span>name,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Grado =</span> <span class="fu">degree</span>(g),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Grado_Norm =</span> <span class="fu">round</span>(<span class="fu">degree</span>(g, <span class="at">normalized =</span> <span class="cn">TRUE</span>), <span class="dv">3</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fuerza =</span> <span class="fu">round</span>(<span class="fu">strength</span>(g), <span class="dv">0</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  Intermediación <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">betweenness</span>(g), <span class="dv">1</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  Intermediación<span class="at">_Norm =</span> <span class="fu">round</span>(<span class="fu">betweenness</span>(g, <span class="at">normalized =</span> <span class="cn">TRUE</span>), <span class="dv">3</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  Cercanía <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">closeness</span>(g), <span class="dv">4</span>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  Cercanía<span class="at">_Norm =</span> <span class="fu">round</span>(<span class="fu">closeness</span>(g, <span class="at">normalized =</span> <span class="cn">TRUE</span>), <span class="dv">3</span>),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Eigenvector =</span> <span class="fu">round</span>(<span class="fu">eigen_centrality</span>(g)<span class="sc">$</span>vector, <span class="dv">3</span>),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Comunidad =</span> <span class="fu">V</span>(g)<span class="sc">$</span>community</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Fuerza))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tbl-cap="Métricas de centralidad de las sustancias en la red">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>centrality_metrics <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sustancia, Grado, Fuerza, Intermediación_Norm, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>         Cercanía_Norm, Eigenvector, Comunidad) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Sustancia"</span>, <span class="st">"Grado"</span>, <span class="st">"Fuerza"</span>, <span class="st">"Intermediación"</span>, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Cercanía"</span>, <span class="st">"Eigenvector"</span>, <span class="st">"Comunidad"</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="fu">rep</span>(<span class="st">"r"</span>, <span class="dv">6</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">width =</span> <span class="st">"150px"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Métricas de centralidad de las sustancias en la red</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Sustancia</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Grado</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Fuerza</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Intermediación</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cercanía</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Eigenvector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Comunidad</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 150px; font-weight: bold;">Alcohol</td>
<td style="text-align: left;">Alcohol</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">230800</td>
<td style="text-align: right;">0.167</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 150px; font-weight: bold;">Marihuana</td>
<td style="text-align: left;">Marihuana</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">187732</td>
<td style="text-align: right;">0.197</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.880</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 150px; font-weight: bold;">Pasta Base</td>
<td style="text-align: left;">Pasta Base</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">170589</td>
<td style="text-align: right;">0.091</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.831</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 150px; font-weight: bold;">Cocaína</td>
<td style="text-align: left;">Cocaína</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">162353</td>
<td style="text-align: right;">0.318</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.790</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 150px; font-weight: bold;">Sedantes/Benzodiacepinas</td>
<td style="text-align: left;">Sedantes/Benzodiacepinas</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12445</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.063</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 150px; font-weight: bold;">Otros</td>
<td style="text-align: left;">Otros</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7502</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.038</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 150px; font-weight: bold;">Sedantes</td>
<td style="text-align: left;">Sedantes</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5072</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.025</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 150px; font-weight: bold;">Inhalables</td>
<td style="text-align: left;">Inhalables</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3817</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.019</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 150px; font-weight: bold;">Anfetaminas</td>
<td style="text-align: left;">Anfetaminas</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3594</td>
<td style="text-align: right;">0.106</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.018</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 150px; font-weight: bold;">Opioides</td>
<td style="text-align: left;">Opioides</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2041</td>
<td style="text-align: right;">0.182</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.010</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="comparación-visual-de-centralidades" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="comparación-visual-de-centralidades"><span class="header-section-number">5.2</span> Comparación Visual de Centralidades</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar datos para visualización</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>centrality_long <span class="ot">&lt;-</span> centrality_metrics <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sustancia, Grado_Norm, Intermediación_Norm, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>         Cercanía_Norm, Eigenvector) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Sustancia,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Métrica"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Valor"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(Métrica <span class="ot">=</span> <span class="fu">str_replace</span>(Métrica, <span class="st">"_Norm"</span>, <span class="st">""</span>),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>         Métrica <span class="ot">=</span> <span class="fu">factor</span>(Métrica, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Grado"</span>, <span class="st">"Intermediación"</span>, </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Cercanía"</span>, <span class="st">"Eigenvector"</span>)))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(centrality_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Sustancia, Valor), </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y =</span> Valor, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fill =</span> Métrica)) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Valor Normalizado"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Comparación de Métricas de Centralidad"</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Top 10 sustancias por fuerza de conexiones"</span>) <span class="sc">+</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stage1_files/figure-html/centrality-comparison-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Comparación de diferentes métricas de centralidad</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="análisis-de-comunidades" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Análisis de Comunidades</h1>
<div class="cell" data-tbl-cap="Composición de las comunidades detectadas">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Análisis de comunidades</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>community_analysis <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sustancia =</span> <span class="fu">V</span>(g)<span class="sc">$</span>name,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Comunidad =</span> <span class="fu">V</span>(g)<span class="sc">$</span>community,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fuerza =</span> <span class="fu">strength</span>(g)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Comunidad) <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    Tamaño <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sustancias =</span> <span class="fu">paste</span>(<span class="fu">head</span>(Sustancia[<span class="fu">order</span>(Fuerza, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)], <span class="dv">3</span>), </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Fuerza_Total =</span> <span class="fu">sum</span>(Fuerza),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Fuerza_Media =</span> <span class="fu">round</span>(<span class="fu">mean</span>(Fuerza), <span class="dv">0</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Tamaño))</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>community_analysis <span class="sc">%&gt;%</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Comunidad"</span>, <span class="st">"Tamaño"</span>, <span class="st">"Principales Sustancias"</span>, </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Fuerza Total"</span>, <span class="st">"Fuerza Media"</span>),</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"c"</span>, <span class="st">"r"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">3</span>, <span class="at">width =</span> <span class="st">"300px"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Composición de las comunidades detectadas</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Comunidad</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tamaño</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Principales Sustancias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Fuerza Total</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Fuerza Media</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: left; width: 300px;">Alcohol, Marihuana, Pasta Base</td>
<td style="text-align: right;">788286</td>
<td style="text-align: right;">60637</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="visualización-de-comunidades" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="visualización-de-comunidades"><span class="header-section-number">6.1</span> Visualización de Comunidades</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráfico de barras apiladas por comunidad</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>community_composition <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sustancia =</span> <span class="fu">V</span>(g)<span class="sc">$</span>name,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Comunidad =</span> <span class="fu">factor</span>(<span class="fu">V</span>(g)<span class="sc">$</span>community),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fuerza =</span> <span class="fu">strength</span>(g)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Comunidad, <span class="fu">desc</span>(Fuerza))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(community_composition, <span class="fu">aes</span>(<span class="at">x =</span> Comunidad, <span class="at">y =</span> Fuerza, <span class="at">fill =</span> Sustancia)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(<span class="dv">12</span>, <span class="st">"Set3"</span>))(<span class="fu">length</span>(<span class="fu">V</span>(g)<span class="sc">$</span>name))) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Comunidad"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Fuerza Total de Conexiones"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Composición de las Comunidades por Fuerza de Conexiones"</span>) <span class="sc">+</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stage1_files/figure-html/community-viz-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Distribución de comunidades en la red</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="patrones-de-co-consumo" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Patrones de Co-consumo</h1>
<section id="tríadas-más-frecuentes" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="tríadas-más-frecuentes"><span class="header-section-number">7.1</span> Tríadas Más Frecuentes</h2>
<div class="cell" data-tbl-cap="Top 10 tríadas de sustancias más frecuentes">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar tríadas comunes</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>identify_triads <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sustancia_principal), </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">is.na</span>(otras_sustancias_no1), </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">is.na</span>(otras_sustancias_no2)) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">triad =</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">c</span>(sustancia_principal, </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                                otras_sustancias_no1, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                                otras_sustancias_no2)), </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">collapse =</span> <span class="st">" + "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(triad, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Porcentaje =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">nrow</span>(df), <span class="dv">2</span>))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>triads <span class="ot">&lt;-</span> <span class="fu">identify_triads</span>(data_network) <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>triads <span class="sc">%&gt;%</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(triad, n, Porcentaje) <span class="sc">%&gt;%</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Tríada de Sustancias"</span>, <span class="st">"Frecuencia"</span>, <span class="st">"Porcentaje (%)"</span>),</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"400px"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f0f0f0"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Top 10 tríadas de sustancias más frecuentes</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Tríada de Sustancias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Frecuencia</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Porcentaje (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 400px; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">Alcohol + Marihuana + Pasta Base</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">27314</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">12.25</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 400px; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">Alcohol + Cocaína + Marihuana</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">20417</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">9.15</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 400px; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">Alcohol + Cocaína + Pasta Base</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">14931</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 240, 240, 255) !important;">6.69</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 400px;">Cocaína + Marihuana + Pasta Base</td>
<td style="text-align: right;">10419</td>
<td style="text-align: right;">4.67</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 400px;">Alcohol + Cocaína + Sedantes/Benzodiacepinas</td>
<td style="text-align: right;">578</td>
<td style="text-align: right;">0.26</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 400px;">Alcohol + Marihuana + Sedantes/Benzodiacepinas</td>
<td style="text-align: right;">577</td>
<td style="text-align: right;">0.26</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 400px;">Alcohol + Pasta Base + Sedantes/Benzodiacepinas</td>
<td style="text-align: right;">391</td>
<td style="text-align: right;">0.18</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 400px;">Alcohol + Cocaína + Sedantes</td>
<td style="text-align: right;">372</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 400px;">Alcohol + Otros + Pasta Base</td>
<td style="text-align: right;">353</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 400px;">Alcohol + Marihuana + Otros</td>
<td style="text-align: right;">330</td>
<td style="text-align: right;">0.15</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="matriz-de-calor" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="matriz-de-calor"><span class="header-section-number">7.2</span> Matriz de Calor</h2>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar top sustancias para el heatmap</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>top_n <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">nrow</span>(co_matrix))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>top_substances <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">rowSums</span>(co_matrix), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span>top_n])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>co_matrix_subset <span class="ot">&lt;-</span> co_matrix[top_substances, top_substances]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalizar por fila</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>co_matrix_norm <span class="ot">&lt;-</span> <span class="fu">sweep</span>(co_matrix_subset, <span class="dv">1</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">pmax</span>(<span class="fu">rowSums</span>(co_matrix_subset), <span class="dv">1</span>), <span class="st">"/"</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir a formato largo para ggplot</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>co_matrix_long <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(co_matrix_norm)) <span class="sc">%&gt;%</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Sustancia1 =</span> Var1, <span class="at">Sustancia2 =</span> Var2, <span class="at">Porcentaje =</span> Freq)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(co_matrix_long, <span class="fu">aes</span>(<span class="at">x =</span> Sustancia1, <span class="at">y =</span> Sustancia2, <span class="at">fill =</span> Porcentaje)) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(Porcentaje, <span class="dv">0</span>)), </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">mid =</span> <span class="st">"#FEC44F"</span>, <span class="at">high =</span> <span class="st">"#D95F0E"</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="dv">50</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"Co-ocurrencia</span><span class="sc">\n</span><span class="st">(%)"</span>) <span class="sc">+</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Matriz de Co-ocurrencia de Sustancias"</span>,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Porcentaje de co-ocurrencia respecto al total de cada sustancia"</span>) <span class="sc">+</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stage1_files/figure-html/heatmap-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Matriz de co-ocurrencia de las sustancias más frecuentes</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="análisis-de-distribución-de-grado" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Análisis de Distribución de Grado</h1>
<div class="cell">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular distribución de grado</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>degree_dist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Grado =</span> <span class="fu">degree</span>(g_full)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Grado) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Probabilidad =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear visualización con escala log-log</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(degree_dist, <span class="fu">aes</span>(<span class="at">x =</span> Grado, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Grado (k)"</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frecuencia"</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Distribución de Grado"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Escala lineal"</span>) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(degree_dist[degree_dist<span class="sc">$</span>Grado <span class="sc">&gt;</span> <span class="dv">0</span>,], </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Grado, <span class="at">y =</span> Probabilidad)) <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"log(Grado)"</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"log(P(k))"</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Distribución de Grado"</span>,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Escala log-log"</span>) <span class="sc">+</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stage1_files/figure-html/degree-distribution-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Distribución del grado de los nodos en la red</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="medidas-de-centralización" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Medidas de Centralización</h1>
<div class="cell" data-tbl-cap="Medidas de centralización de la red">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular medidas de centralización</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>centralization_measures <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Medida =</span> <span class="fu">c</span>(<span class="st">"Centralización de Grado"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Centralización de Cercanía"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Centralización de Intermediación"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Centralización de Eigenvector"</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">c</span>(<span class="fu">round</span>(<span class="fu">centr_degree</span>(g)<span class="sc">$</span>centralization, <span class="dv">4</span>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="fu">centr_clo</span>(g)<span class="sc">$</span>centralization, <span class="dv">4</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="fu">centr_betw</span>(g)<span class="sc">$</span>centralization, <span class="dv">4</span>),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="fu">centr_eigen</span>(g)<span class="sc">$</span>centralization, <span class="dv">4</span>)),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  Interpretación <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Concentración de conexiones directas"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Concentración de accesibilidad"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Concentración de control de flujo"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Concentración de influencia"</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>centralization_measures <span class="sc">%&gt;%</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"l"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">width =</span> <span class="st">"250px"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">width =</span> <span class="st">"100px"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">3</span>, <span class="at">width =</span> <span class="st">"300px"</span>, <span class="at">italic =</span> <span class="cn">TRUE</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Medidas de centralización de la red</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Medida</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Valor</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interpretación</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 250px; font-weight: bold;">Centralización de Grado</td>
<td style="text-align: right; width: 100px;">0.4936</td>
<td style="text-align: left; width: 300px; font-style: italic;">Concentración de conexiones directas</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px; font-weight: bold;">Centralización de Cercanía</td>
<td style="text-align: right; width: 100px;">0.6167</td>
<td style="text-align: left; width: 300px; font-style: italic;">Concentración de accesibilidad</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px; font-weight: bold;">Centralización de Intermediación</td>
<td style="text-align: right; width: 100px;">0.2689</td>
<td style="text-align: left; width: 300px; font-style: italic;">Concentración de control de flujo</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px; font-weight: bold;">Centralización de Eigenvector</td>
<td style="text-align: right; width: 100px;">0.4768</td>
<td style="text-align: left; width: 300px; font-style: italic;">Concentración de influencia</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="conclusiones" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Conclusiones</h1>
<section id="hallazgos-principales" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="hallazgos-principales"><span class="header-section-number">10.1</span> Hallazgos Principales</h2>
<div class="cell" data-tbl-cap="Resumen de hallazgos principales">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar sustancias clave</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>top_degree <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">degree</span>(g), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>top_between <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">betweenness</span>(g), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>])</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>top_eigen <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">eigen_centrality</span>(g)<span class="sc">$</span>vector, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>])</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>findings <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Aspecto =</span> <span class="fu">c</span>(<span class="st">"Sustancia más conectada"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Sustancia puente principal"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Sustancia más influyente"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Porcentaje de policonsumo"</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Tamaño promedio de combinación"</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Patrón más común"</span>),</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Hallazgo =</span> <span class="fu">c</span>(top_degree,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>               top_between,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>               top_eigen,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>               <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="dv">100</span> <span class="sc">-</span> combo_stats<span class="sc">$</span>Porcentaje[combo_stats<span class="sc">$</span>n_sustancias <span class="sc">==</span> <span class="dv">1</span>], <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>               <span class="fu">round</span>(<span class="fu">mean</span>(data_network <span class="sc">%&gt;%</span> </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">pull</span>(n)), <span class="dv">1</span>),</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>               triads<span class="sc">$</span>triad[<span class="dv">1</span>])</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>findings <span class="sc">%&gt;%</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Aspecto Analizado"</span>, <span class="st">"Hallazgo Principal"</span>),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"l"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">width =</span> <span class="st">"250px"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">width =</span> <span class="st">"300px"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Resumen de hallazgos principales</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Aspecto Analizado</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Hallazgo Principal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; width: 250px; font-weight: bold;">Sustancia más conectada</td>
<td style="text-align: left; width: 300px;">Marihuana</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px; font-weight: bold;">Sustancia puente principal</td>
<td style="text-align: left; width: 300px;">Cocaína</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px; font-weight: bold;">Sustancia más influyente</td>
<td style="text-align: left; width: 300px;">Alcohol</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px; font-weight: bold;">Porcentaje de policonsumo</td>
<td style="text-align: left; width: 300px;">71%</td>
</tr>
<tr class="odd">
<td style="text-align: left; width: 250px; font-weight: bold;">Tamaño promedio de combinación</td>
<td style="text-align: left; width: 300px;">2.2</td>
</tr>
<tr class="even">
<td style="text-align: left; width: 250px; font-weight: bold;">Patrón más común</td>
<td style="text-align: left; width: 300px;">Alcohol + Marihuana + Pasta Base</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="implicaciones" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="implicaciones"><span class="header-section-number">10.2</span> Implicaciones</h2>
<p>El análisis de redes revela patrones complejos de policonsumo con importantes implicaciones:</p>
<ol type="1">
<li><strong>Alta prevalencia de policonsumo</strong>: La mayoría de los casos involucran múltiples sustancias</li>
<li><strong>Sustancias centrales</strong>: Algunas sustancias actúan como nodos centrales en las redes de consumo</li>
<li><strong>Comunidades definidas</strong>: Existen grupos claros de sustancias que tienden a consumirse juntas</li>
<li><strong>Patrones recurrentes</strong>: Se identifican tríadas y combinaciones específicas que se repiten frecuentemente</li>
</ol>
<hr>
<p><em>Documento generado el 19 de agosto de 2025</em></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiado");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiado");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="Stage1_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>